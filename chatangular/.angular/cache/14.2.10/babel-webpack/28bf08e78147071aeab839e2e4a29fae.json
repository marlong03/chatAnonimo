{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/SystemForLinux/Desktop/f2/code/chat/chatangular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet ChatComponent = class ChatComponent {\n  constructor(router, usuarioService, mensajeService, websocketService) {\n    this.router = router;\n    this.usuarioService = usuarioService;\n    this.mensajeService = mensajeService;\n    this.websocketService = websocketService;\n    this.listaMensajes = [];\n    this.mensajeEnviar = \"\";\n  }\n\n  ngOnInit() {\n    this.getSalaDates();\n    setTimeout(() => {\n      this.obaqui();\n      console.log(\"cargando... otra vez\");\n    }, 3000);\n    this.llenarMensajes();\n    this.suscription = this.mensajeService.refresh$.subscribe(() => {\n      this.llenarMensajes();\n      /* this.websocketService.connect() */\n    });\n    /* this.getUsuarioChateando() */\n  }\n\n  getSalaDates() {\n    let salaDates = JSON.parse(localStorage.getItem('salachat')) || '{}';\n    this.sala = salaDates[0];\n    console.log(this.sala);\n  }\n\n  getUsuarioChateando() {\n    return _asyncToGenerator(function* () {\n      return new Promise((resolve, reject) => {\n        let usuarioChat = JSON.parse(localStorage.getItem(\"usuariochat\"));\n\n        if (usuarioChat) {\n          resolve(usuarioChat);\n        } else {\n          reject(new Error('No se ha encontrado el usuario en el local storage'));\n        }\n      });\n    })();\n  }\n\n  obaqui() {\n    this.getUsuarioChateando().then(usuarioChat => {\n      this.usuarioService.getUsuarioByIdentificador(usuarioChat.identificadorusuario).subscribe(u => {\n        localStorage.setItem(\"usuariochat\", JSON.stringify(u));\n        this.usuario = u;\n      });\n    }).catch(error => {\n      console.error(error);\n    });\n  }\n\n  llenarMensajes() {\n    this.listaMensajes = [];\n    this.mensajeService.getMensajesByIdSala(this.sala.idsala).subscribe(mensajes => {\n      for (let m of mensajes) {\n        this.listaMensajes.push(m);\n      }\n    });\n  }\n\n  enviarMensaje() {\n    /* this.websocketService.disconnect() */\n    console.log(this.mensajeEnviar);\n    let mensaje = {\n      idmensaje: 0,\n      datamensaje: this.mensajeEnviar,\n      fksalamensaje: this.sala.idsala,\n      fkusuariomensaje: this.usuario.idusuario\n    };\n    this.mensajeService.postMensaje(mensaje);\n    this.mensajeEnviar = \"\";\n  }\n\n  direccionarUrl(donde) {\n    this.router.navigate([donde]);\n  }\n\n};\nChatComponent = __decorate([Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.css']\n})], ChatComponent);\nexport { ChatComponent };","map":{"version":3,"mappings":"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","names":["Component","ChatComponent","constructor","router","usuarioService","mensajeService","websocketService","ngOnInit","getSalaDates","setTimeout","obaqui","console","log","llenarMensajes","suscription","refresh$","subscribe","salaDates","JSON","parse","localStorage","getItem","sala","getUsuarioChateando","Promise","resolve","reject","usuarioChat","Error","then","getUsuarioByIdentificador","identificadorusuario","u","setItem","stringify","usuario","catch","error","listaMensajes","getMensajesByIdSala","idsala","mensajes","m","push","enviarMensaje","mensajeEnviar","mensaje","idmensaje","datamensaje","fksalamensaje","fkusuariomensaje","idusuario","postMensaje","direccionarUrl","donde","navigate","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\SystemForLinux\\Desktop\\f2\\code\\chat\\chatangular\\src\\app\\components\\chat\\chat.component.ts"],"sourcesContent":["import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Subscription } from 'rxjs';\nimport { Mensaje } from 'src/app/models/Mensaje';\nimport { MensajeService } from 'src/app/services/mensaje.service';\nimport { UsuarioService } from 'src/app/services/usuario.service';\nimport { WebSocketService } from 'src/app/services/WebSocket.service';\n\n@Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.css']\n})\nexport class ChatComponent implements OnInit {\n\n  constructor(private router:Router,\n              private usuarioService:UsuarioService,\n              private mensajeService:MensajeService,\n              private websocketService:WebSocketService) { }\n  \n  ngOnInit(): void {\n    this.getSalaDates()\n    setTimeout(() => {\n      this.obaqui()\n      console.log(\"cargando... otra vez\");\n    }, 3000);\n  \n      this.llenarMensajes()\n      this.suscription = this.mensajeService.refresh$.subscribe(()=>{\n        this.llenarMensajes()\n        /* this.websocketService.connect() */\n      })\n   \n    /* this.getUsuarioChateando() */\n  }\n    /* getUsuarioChateando(){\n      \n       let usuarioChat =   JSON.parse(localStorage.getItem(\"usuariochat\"))\n    console.log(usuarioChat);\n    \n  } */\nsala:any\ngetSalaDates(){\n  let salaDates =  JSON.parse(localStorage.getItem('salachat')) || '{}'\n  this.sala = salaDates[0];\n  console.log(this.sala);\n}\nasync getUsuarioChateando(){\n  return new Promise((resolve, reject) => {\n    let usuarioChat = JSON.parse(localStorage.getItem(\"usuariochat\"))\n    if (usuarioChat) {\n      resolve(usuarioChat)\n    } else {\n      reject(new Error('No se ha encontrado el usuario en el local storage'))\n    }\n  })\n}\nusuario:any;\nobaqui(){\n  this.getUsuarioChateando().then((usuarioChat:any) => {\n    this.usuarioService.getUsuarioByIdentificador(usuarioChat.identificadorusuario).subscribe((u:any)=>{\n      localStorage.setItem(\"usuariochat\",JSON.stringify(u));\n      this.usuario = u;\n\n    })\n  }).catch((error:any) => {\n    console.error(error)\n  })\n}\nlistaMensajes = []\nllenarMensajes(){\n  this.listaMensajes = []\n  this.mensajeService.getMensajesByIdSala(this.sala.idsala).subscribe((mensajes:any)=>{\n    for(let m of mensajes){\n      this.listaMensajes.push(m)\n    }\n  })\n}\nmensajeEnviar = \"\"\nsuscription:Subscription;\nenviarMensaje(){\n  /* this.websocketService.disconnect() */\n  console.log(this.mensajeEnviar);\n  let mensaje:Mensaje = {\n    idmensaje:0,\n    datamensaje:this.mensajeEnviar,\n    fksalamensaje:this.sala.idsala,\n    fkusuariomensaje:this.usuario.idusuario,\n  }\n  \n  this.mensajeService.postMensaje(mensaje)\n  this.mensajeEnviar = \"\"\n \n  \n}\n  direccionarUrl(donde:string){\n    this.router.navigate([donde])\n  }\n}\n"]},"metadata":{},"sourceType":"module"}