{"ast":null,"code":"import { Subscription } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/usuario.service\";\nimport * as i3 from \"src/app/services/mensaje.service\";\nimport * as i4 from \"src/app/services/web-socket.service\";\nimport * as i5 from \"ngx-cookie-service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\n\nfunction ChatComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const m_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(m_r2.datamensaje);\n  }\n}\n/* import { WebSocketAPI } from 'src/app/WebSocketAPI'; */\n\n/* import { AppComponent } from '../../../../../../../../angular8-springboot-websocket-master/angular8-springboot-websocket-master/front-end/angular8-springboot-websocket/src/app/app.component'; */\n\n/* import { WebSocketService } from 'src/app/services/WebSocket.service'; */\n\n\nexport class ChatComponent {\n  constructor(router, route, usuarioService, mensajeService, socketService, cookieService) {\n    this.router = router;\n    this.route = route;\n    this.usuarioService = usuarioService;\n    this.mensajeService = mensajeService;\n    this.socketService = socketService;\n    this.cookieService = cookieService;\n    this.codigoChat = route.snapshot.paramMap.get('codigoChat');\n    cookieService.set('codigoChat', this.codigoChat);\n  }\n\n  ngAfterViewInit() {\n    console.log(this.codigoChat);\n  }\n\n  ngOnInit() {\n    /* let socket = io('http://localhost:3000', {\r\n      withCredentials: true,\r\n      extraHeaders: {\r\n        \"my-custom-header\": \"abcd\"\r\n      }\r\n    }); */\n\n    /*  socket.on('msg',function(data:any){\r\n       console.log(data);\r\n       \r\n     }) */\n    this.getSalaDates();\n    setTimeout(() => {\n      this.setearUsuarioLocalStorage();\n      console.log(\"cargando... otra vez\");\n    }, 3000);\n    this.llenarMensajes();\n\n    sala: any;\n\n    getSalaDates();\n    {\n      let salaDates = JSON.parse(localStorage.getItem('salachat'));\n      this.sala = salaDates[0];\n      console.log(this.sala);\n    }\n    /* async getUsuarioChateando(){\r\n      return new Promise((resolve, reject) => {\r\n        let usuarioChat = JSON.parse(localStorage.getItem(\"usuariochat\"))\r\n        if (usuarioChat) {\r\n          resolve(usuarioChat)\r\n        } else {\r\n          reject(new Error('No se ha encontrado el usuario en el local storage'))\r\n        }\r\n      })\r\n    } */\n\n    usuarioSet: any = JSON.parse(localStorage.getItem('usuariochat'));\n    /* idUsuario = 0 */\n\n\n    usuario: any;\n\n    setearUsuarioLocalStorage();\n    {\n      /* this.getUsuarioChateando().then((usuarioChat:any) => { */\n      console.log(this.usuarioSet.identificadorusuario);\n\n      if (this.usuarioSet.identificadorusuario != undefined) {\n        this.usuarioService.getUsuarioByIdentificador(this.usuarioSet.identificadorusuario).subscribe(u => {\n          console.log(u);\n          this.usuario = u[0];\n          console.log(this.usuario);\n          /* this.idUsuario = u[0].idusuario;\r\n          console.log(this.idUsuario); */\n\n          /*  setTimeout(() => { */\n\n          localStorage.setItem(\"usuariochat\", JSON.stringify(u[0]));\n          /*  }, 1000); */\n        });\n      } else {\n        console.log(\"el usuario no se encontro\");\n      }\n      /*  }).catch((error:any) => {\r\n         console.error(error)\r\n       }) */\n\n    }\n    listaMensajes = [];\n    llenarMensajes();\n    {\n      this.listaMensajes = [];\n      this.mensajeService.getMensajesByIdSala(this.sala.idsala).subscribe(mensajes => {\n        for (let m of mensajes) {\n          this.listaMensajes.push(m);\n        }\n      });\n    }\n    mensajeEnviar = \"\";\n\n    suscription: Subscription;\n\n    enviarMensaje();\n    {\n      /* this.websocketService.disconnect() */\n\n      /*   let socket = socketio.io('http://localhost:4200/chat'); */\n\n      /*   socket.emit(\"chat message\",\"mensaje desde angular\") */\n      console.log(this.mensajeEnviar);\n      console.log(this.usuario);\n      let mensaje = {\n        idmensaje: 0,\n        datamensaje: this.mensajeEnviar,\n        fksalamensaje: this.sala.idsala,\n        fkusuariomensaje: this.usuario.idusuario\n      };\n      /* this.socket.emit('chat msg',mensaje) */\n\n      this.mensajeService.postMensaje(mensaje);\n      this.mensajeEnviar = \"\";\n      /*  this.sendMessage() */\n    }\n    direccionarUrl(donde, string);\n    {\n      this.router.navigate([donde]);\n    }\n  }\n\n}\n\nChatComponent.ɵfac = function ChatComponent_Factory(t) {\n  return new (t || ChatComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.UsuarioService), i0.ɵɵdirectiveInject(i3.MensajeService), i0.ɵɵdirectiveInject(i4.WebSocketService), i0.ɵɵdirectiveInject(i5.CookieService));\n};\n\nChatComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ChatComponent,\n  selectors: [[\"app-chat\"]],\n  decls: 16,\n  vars: 3,\n  consts: [[1, \"chat\"], [1, \"chat__header\", \"d-flex\", \"justify-content-between\", \"align-items-center\", \"px-4\", \"py-4\"], [\"type\", \"button\", \"value\", \"Salir\", 1, \"btn\", \"btn-outline-light\", 3, \"click\"], [1, \"chat__box\"], [\"chat\", \"\"], [\"class\", \"msg__box border p-3 d-flex justify-content-start m-3\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"text\", \"autofocus\", \"\", 1, \"input__autofocus\"], [1, \"chat__footer\"], [1, \"chat__container--input_message\", \"d-flex\", \"justify-content-center\", \"py-3\", \"px-2\", \"border\"], [\"type\", \"text\", \"placeholder\", \"Escribe algo...\", 1, \"border\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn__enviar\", \"d-flex\", \"justify-content-center\", \"align-items-center\", \"p-2\", 3, \"click\"], [\"src\", \"../../assets/imgs/enviar.png\", \"alt\", \"boton para enviar\"], [1, \"msg__box\", \"border\", \"p-3\", \"d-flex\", \"justify-content-start\", \"m-3\"]],\n  template: function ChatComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\")(3, \"h3\");\n      i0.ɵɵtext(4);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(5, \"div\")(6, \"input\", 2);\n      i0.ɵɵlistener(\"click\", function ChatComponent_Template_input_click_6_listener() {\n        return ctx.direccionarUrl(\"\");\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(7, \"div\", 3, 4);\n      i0.ɵɵtemplate(9, ChatComponent_div_9_Template, 3, 1, \"div\", 5);\n      i0.ɵɵelement(10, \"input\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"div\", 7)(12, \"div\", 8)(13, \"input\", 9);\n      i0.ɵɵlistener(\"ngModelChange\", function ChatComponent_Template_input_ngModelChange_13_listener($event) {\n        return ctx.mensajeEnviar = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(14, \"button\", 10);\n      i0.ɵɵlistener(\"click\", function ChatComponent_Template_button_click_14_listener() {\n        return ctx.enviarMensaje();\n      });\n      i0.ɵɵelement(15, \"img\", 11);\n      i0.ɵɵelementEnd()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate(ctx.sala.codigosala);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngForOf\", ctx.listaMensajes);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.mensajeEnviar);\n    }\n  },\n  dependencies: [i6.NgForOf, i7.DefaultValueAccessor, i7.NgControlStatus, i7.NgModel],\n  styles: [\".chat[_ngcontent-%COMP%]{\\r\\n    height: 100vh;\\r\\n}\\r\\n.chat__header[_ngcontent-%COMP%]{\\r\\n    background-color: var(--yel);\\r\\n    box-shadow: 0px 0px 20px #c6c6c6;\\r\\n    z-index:100;\\r\\n    position: relative;\\r\\n}\\r\\n.chat__header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{\\r\\n    border-bottom: 3px double white;\\r\\n    color:white;\\r\\n    padding: 5px;\\r\\n    text-shadow: 2px 2px 5px #827501;\\r\\n}\\r\\n.chat__container--input_message[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{\\r\\n    width: 80%;\\r\\n    padding:10px 20px;\\r\\n    border-radius: 10px;\\r\\n    outline: none;\\r\\n}\\r\\n\\r\\n.chat__footer[_ngcontent-%COMP%]{\\r\\n    border-top: 3px solid #dbdbdb;\\r\\n    position: absolute;\\r\\n    width: 100%;\\r\\n    bottom: 0;\\r\\n    z-index:100;\\r\\n    background-color: white;\\r\\n}\\r\\n.chat__box[_ngcontent-%COMP%]{\\r\\n    position: relative;\\r\\n    z-index: 50;\\r\\n    max-height: 400px !important;\\r\\n    overflow: scroll;\\r\\n    overflow-y:scroll ;\\r\\n    overflow-x: hidden;\\r\\n    scroll-behavior:smooth;\\r\\n\\r\\n}\\r\\n.msg__box[_ngcontent-%COMP%]{\\r\\n    background-color: white;\\r\\n    border-radius: 10px;\\r\\n    max-width: 300px;\\r\\n    white-space: pre-wrap;\\r\\n    box-shadow: 5px 5px 5px #e9e9e9;\\r\\n    \\r\\n    \\r\\n\\r\\n}\\r\\n.btn__enviar[_ngcontent-%COMP%]{\\r\\n    border-radius: 100px;\\r\\n    background-color: var(--yel);\\r\\n    border:3px solid #c1c1c1;\\r\\n    margin-left: 10px;\\r\\n\\r\\n}\\r\\n.btn__enviar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{\\r\\n    width: 23px;\\r\\n    filter: drop-shadow(0 2px 5px #ffffff9b);\\r\\n}\\r\\n.btn__enviar[_ngcontent-%COMP%]:hover{\\r\\n    background-color: #ababab;\\r\\n    border:3px solid #4e4d4d;\\r\\n\\r\\n\\r\\n}\\r\\n.input__autofocus[_ngcontent-%COMP%]{\\r\\n    width: 0px;\\r\\n    height: 0px;\\r\\n    border: none;\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXQuY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQUNJLGFBQWE7QUFDakI7QUFDQTtJQUNJLDRCQUE0QjtJQUM1QixnQ0FBZ0M7SUFDaEMsV0FBVztJQUNYLGtCQUFrQjtBQUN0QjtBQUNBO0lBQ0ksK0JBQStCO0lBQy9CLFdBQVc7SUFDWCxZQUFZO0lBQ1osZ0NBQWdDO0FBQ3BDO0FBQ0E7SUFDSSxVQUFVO0lBQ1YsaUJBQWlCO0lBQ2pCLG1CQUFtQjtJQUNuQixhQUFhO0FBQ2pCO0FBQ0E7Ozs7R0FJRztBQUNIO0lBQ0ksNkJBQTZCO0lBQzdCLGtCQUFrQjtJQUNsQixXQUFXO0lBQ1gsU0FBUztJQUNULFdBQVc7SUFDWCx1QkFBdUI7QUFDM0I7QUFDQTtJQUNJLGtCQUFrQjtJQUNsQixXQUFXO0lBQ1gsNEJBQTRCO0lBQzVCLGdCQUFnQjtJQUNoQixrQkFBa0I7SUFDbEIsa0JBQWtCO0lBQ2xCLHNCQUFzQjs7QUFFMUI7QUFDQTtJQUNJLHVCQUF1QjtJQUN2QixtQkFBbUI7SUFDbkIsZ0JBQWdCO0lBQ2hCLHFCQUFxQjtJQUNyQiwrQkFBK0I7Ozs7QUFJbkM7QUFDQTtJQUNJLG9CQUFvQjtJQUNwQiw0QkFBNEI7SUFDNUIsd0JBQXdCO0lBQ3hCLGlCQUFpQjs7QUFFckI7QUFDQTtJQUNJLFdBQVc7SUFDWCx3Q0FBd0M7QUFDNUM7QUFDQTtJQUNJLHlCQUF5QjtJQUN6Qix3QkFBd0I7OztBQUc1QjtBQUNBO0lBQ0ksVUFBVTtJQUNWLFdBQVc7SUFDWCxZQUFZO0FBQ2hCIiwiZmlsZSI6ImNoYXQuY29tcG9uZW50LmNzcyIsInNvdXJjZXNDb250ZW50IjpbIi5jaGF0e1xyXG4gICAgaGVpZ2h0OiAxMDB2aDtcclxufVxyXG4uY2hhdF9faGVhZGVye1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0teWVsKTtcclxuICAgIGJveC1zaGFkb3c6IDBweCAwcHggMjBweCAjYzZjNmM2O1xyXG4gICAgei1pbmRleDoxMDA7XHJcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XHJcbn1cclxuLmNoYXRfX2hlYWRlciBoM3tcclxuICAgIGJvcmRlci1ib3R0b206IDNweCBkb3VibGUgd2hpdGU7XHJcbiAgICBjb2xvcjp3aGl0ZTtcclxuICAgIHBhZGRpbmc6IDVweDtcclxuICAgIHRleHQtc2hhZG93OiAycHggMnB4IDVweCAjODI3NTAxO1xyXG59XHJcbi5jaGF0X19jb250YWluZXItLWlucHV0X21lc3NhZ2UgaW5wdXRbdHlwZT10ZXh0XXtcclxuICAgIHdpZHRoOiA4MCU7XHJcbiAgICBwYWRkaW5nOjEwcHggMjBweDtcclxuICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7XHJcbiAgICBvdXRsaW5lOiBub25lO1xyXG59XHJcbi8qIC5jaGF0X19jb250YWluZXItLWlucHV0X21lc3NhZ2V7XHJcbiAgIFxyXG59XHJcbi5jaGF0X19jb250YWluZXItLWlucHV0X21lc3NhZ2UgaW5wdXRbdHlwZT1idXR0b25de1xyXG59ICovXHJcbi5jaGF0X19mb290ZXJ7XHJcbiAgICBib3JkZXItdG9wOiAzcHggc29saWQgI2RiZGJkYjtcclxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgIHdpZHRoOiAxMDAlO1xyXG4gICAgYm90dG9tOiAwO1xyXG4gICAgei1pbmRleDoxMDA7XHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcclxufVxyXG4uY2hhdF9fYm94e1xyXG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xyXG4gICAgei1pbmRleDogNTA7XHJcbiAgICBtYXgtaGVpZ2h0OiA0MDBweCAhaW1wb3J0YW50O1xyXG4gICAgb3ZlcmZsb3c6IHNjcm9sbDtcclxuICAgIG92ZXJmbG93LXk6c2Nyb2xsIDtcclxuICAgIG92ZXJmbG93LXg6IGhpZGRlbjtcclxuICAgIHNjcm9sbC1iZWhhdmlvcjpzbW9vdGg7XHJcblxyXG59XHJcbi5tc2dfX2JveHtcclxuICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xyXG4gICAgYm9yZGVyLXJhZGl1czogMTBweDtcclxuICAgIG1heC13aWR0aDogMzAwcHg7XHJcbiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XHJcbiAgICBib3gtc2hhZG93OiA1cHggNXB4IDVweCAjZTllOWU5O1xyXG4gICAgXHJcbiAgICBcclxuXHJcbn1cclxuLmJ0bl9fZW52aWFye1xyXG4gICAgYm9yZGVyLXJhZGl1czogMTAwcHg7XHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS15ZWwpO1xyXG4gICAgYm9yZGVyOjNweCBzb2xpZCAjYzFjMWMxO1xyXG4gICAgbWFyZ2luLWxlZnQ6IDEwcHg7XHJcblxyXG59XHJcbi5idG5fX2VudmlhciBpbWd7XHJcbiAgICB3aWR0aDogMjNweDtcclxuICAgIGZpbHRlcjogZHJvcC1zaGFkb3coMCAycHggNXB4ICNmZmZmZmY5Yik7XHJcbn1cclxuLmJ0bl9fZW52aWFyOmhvdmVye1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2FiYWJhYjtcclxuICAgIGJvcmRlcjozcHggc29saWQgIzRlNGQ0ZDtcclxuXHJcblxyXG59XHJcbi5pbnB1dF9fYXV0b2ZvY3Vze1xyXG4gICAgd2lkdGg6IDBweDtcclxuICAgIGhlaWdodDogMHB4O1xyXG4gICAgYm9yZGVyOiBub25lO1xyXG59XHJcblxyXG5cclxuIl19 */\"]\n});","map":{"version":3,"mappings":"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","names":["Subscription","i0","ChatComponent","constructor","router","route","usuarioService","mensajeService","socketService","cookieService","codigoChat","snapshot","paramMap","get","set","ngAfterViewInit","console","log","ngOnInit","getSalaDates","setTimeout","setearUsuarioLocalStorage","llenarMensajes","sala","any","salaDates","JSON","parse","localStorage","getItem","usuarioSet","usuario","identificadorusuario","undefined","getUsuarioByIdentificador","subscribe","u","setItem","stringify","listaMensajes","getMensajesByIdSala","idsala","mensajes","m","push","mensajeEnviar","suscription","enviarMensaje","mensaje","idmensaje","datamensaje","fksalamensaje","fkusuariomensaje","idusuario","postMensaje","direccionarUrl","donde","string","navigate","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\SystemForLinux\\Desktop\\f2\\code\\chat\\chatangular\\src\\app\\components\\chat\\chat.component.ts","C:\\Users\\SystemForLinux\\Desktop\\f2\\code\\chat\\chatangular\\src\\app\\components\\chat\\chat.component.html"],"sourcesContent":["import { AfterViewInit, ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { Subscription } from 'rxjs';\n/* import * as Stomp from 'stompjs'; */\nimport { Mensaje } from 'src/app/models/Mensaje';\nimport { MensajeService } from 'src/app/services/mensaje.service';\nimport { UsuarioService } from 'src/app/services/usuario.service';\nimport { WebSocketService } from 'src/app/services/web-socket.service';\nimport { CookieService } from 'ngx-cookie-service';\n\n/* import { WebSocketAPI } from 'src/app/WebSocketAPI'; */\n/* import { AppComponent } from '../../../../../../../../angular8-springboot-websocket-master/angular8-springboot-websocket-master/front-end/angular8-springboot-websocket/src/app/app.component'; */\n/* import { WebSocketService } from 'src/app/services/WebSocket.service'; */\n\n@Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.css']\n})\nexport class ChatComponent implements OnInit,AfterViewInit {\n  codigoChat:string\n  constructor(private router:Router,\n              private route:ActivatedRoute,\n              private usuarioService:UsuarioService,\n              private mensajeService:MensajeService,\n              private socketService:WebSocketService,\n              public cookieService:CookieService) { \n\n                this.codigoChat = route.snapshot.paramMap.get('codigoChat')\n                cookieService.set('codigoChat',this.codigoChat)\n\n              }\n    ngAfterViewInit(): void {\n        console.log(this.codigoChat);\n        \n    }\n ngOnInit(): void {\n    /* let socket = io('http://localhost:3000', {\n      withCredentials: true,\n      extraHeaders: {\n        \"my-custom-header\": \"abcd\"\n      }\n    }); */\n   /*  socket.on('msg',function(data:any){\n      console.log(data);\n      \n    }) */\n    this.getSalaDates()\n    setTimeout(() => {\n      this.setearUsuarioLocalStorage()\n      console.log(\"cargando... otra vez\");\n    }, 3000);\n  \n      this.llenarMensajes()\n  \nsala:any\ngetSalaDates(){\n  let salaDates =  JSON.parse(localStorage.getItem('salachat')) \n  this.sala = salaDates[0];\n  console.log(this.sala);\n}\n/* async getUsuarioChateando(){\n  return new Promise((resolve, reject) => {\n    let usuarioChat = JSON.parse(localStorage.getItem(\"usuariochat\"))\n    if (usuarioChat) {\n      resolve(usuarioChat)\n    } else {\n      reject(new Error('No se ha encontrado el usuario en el local storage'))\n    }\n  })\n} */\nusuarioSet:any = JSON.parse(localStorage.getItem('usuariochat'));\n/* idUsuario = 0 */\nusuario:any\nsetearUsuarioLocalStorage(){\n  /* this.getUsuarioChateando().then((usuarioChat:any) => { */\n    console.log(this.usuarioSet.identificadorusuario);\n    if(this.usuarioSet.identificadorusuario != undefined){\n\n      this.usuarioService.getUsuarioByIdentificador(this.usuarioSet.identificadorusuario).subscribe((u:any)=>{\n        console.log(u);\n        this.usuario = u[0]\n        console.log(this.usuario);\n        \n        /* this.idUsuario = u[0].idusuario;\n        console.log(this.idUsuario); */\n        \n       /*  setTimeout(() => { */\n          localStorage.setItem(\"usuariochat\",JSON.stringify(u[0]));\n          \n       /*  }, 1000); */\n        \n        \n        \n        \n      })\n    }else{\n      console.log(\"el usuario no se encontro\");\n      \n    }\n /*  }).catch((error:any) => {\n    console.error(error)\n  }) */\n}\nlistaMensajes = []\nllenarMensajes(){\n  this.listaMensajes = []\n  this.mensajeService.getMensajesByIdSala(this.sala.idsala).subscribe((mensajes:any)=>{\n    for(let m of mensajes){\n      this.listaMensajes.push(m)\n    }\n  })\n}\nmensajeEnviar = \"\"\nsuscription:Subscription;\n\nenviarMensaje(){\n  /* this.websocketService.disconnect() */\n/*   let socket = socketio.io('http://localhost:4200/chat'); */\n/*   socket.emit(\"chat message\",\"mensaje desde angular\") */\n  console.log(this.mensajeEnviar);\n  console.log(this.usuario);\n  \n  let mensaje:Mensaje = {\n    idmensaje:0,\n    datamensaje:this.mensajeEnviar,\n    fksalamensaje:this.sala.idsala,\n    fkusuariomensaje:this.usuario.idusuario,\n  }\n  /* this.socket.emit('chat msg',mensaje) */\n  this.mensajeService.postMensaje(mensaje)\n  this.mensajeEnviar = \"\"\n /*  this.sendMessage() */\n  \n}\n\n  direccionarUrl(donde:string){\n    this.router.navigate([donde])\n  }\n}\n","\n<section class=\"chat\">\n    <div class=\"chat__header d-flex justify-content-between align-items-center px-4 py-4\">\n        <div>\n            <h3>{{sala.codigosala}}</h3>\n        </div>\n        <div>\n            <input type=\"button\" value=\"Salir\" class=\"btn btn-outline-light\" (click)=\"direccionarUrl('')\">\n        </div>\n\n    </div>\n    <div class=\"chat__box\" #chat>\n        <div class=\"msg__box border p-3 d-flex justify-content-start m-3\" *ngFor=\"let m of listaMensajes\">\n            <p>{{m.datamensaje}}</p>\n        </div>\n        <input type=\"text\" autofocus class=\"input__autofocus\">\n    </div>\n  <!--   {{msj}} -->\n    <div class=\"chat__footer\">\n        <div class=\"chat__container--input_message d-flex justify-content-center py-3 px-2 border \">\n            <input type=\"text\" class=\"border\" placeholder=\"Escribe algo...\" [(ngModel)]=\"mensajeEnviar\">\n           <button class=\"btn__enviar d-flex justify-content-center align-items-center p-2\" (click)=\"enviarMensaje()\">\n                <img src=\"../../assets/imgs/enviar.png\"  alt=\"boton para enviar\">\n            </button>\n        </div>\n    </div>\n</section>"]},"metadata":{},"sourceType":"module"}